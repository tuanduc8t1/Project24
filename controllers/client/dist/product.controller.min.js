"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}var Product=require("../../models/product.model"),ProductCategory=require("../../models/product-category.model");module.exports.index=function(e,r){var t,n,a,c,o,s,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Product.find({status:"active",deleted:!1}).sort({position:"desc"}));case 2:for(t=e.sent,a=!(n=!0),c=void 0,e.prev=6,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)(i=s.value).priceNew=(i.price*(100-i.discountPercentage)/100).toFixed(0);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),a=!0,c=e.t0;case 14:e.prev=14,e.prev=15,n||null==o.return||o.return();case 17:if(e.prev=17,a)throw c;e.next=20;break;case 20:return e.finish(17);case 21:return e.finish(14);case 22:r.render("client/pages/products/index",{pageTitle:"Danh sách sản phẩm",products:t});case 23:case"end":return e.stop()}},null,null,[[6,10,14,22],[15,,17,21]])},module.exports.category=function(r,t){var n,a,c,o,s,i,u,d,p,l,f,g;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.slugCategory,e.next=3,regeneratorRuntime.awrap(ProductCategory.findOne({slug:n,deleted:!1,status:"active"}));case 3:return a=e.sent,c=function r(t){var n,a,c,o,s,i,u,d,p;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],e.next=3,regeneratorRuntime.awrap(ProductCategory.find({parent_id:t,deleted:!1,status:"active"}).select("id title"));case 3:a=e.sent,n=_toConsumableArray(a),o=!(c=!0),s=void 0,e.prev=8,i=a[Symbol.iterator]();case 10:if(c=(u=i.next()).done){e.next=19;break}return d=u.value,e.next=14,regeneratorRuntime.awrap(r(d.id));case 14:p=e.sent,n=n.concat(p);case 16:c=!0,e.next=10;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(8),o=!0,s=e.t0;case 25:e.prev=25,e.prev=26,c||null==i.return||i.return();case 28:if(e.prev=28,o)throw s;e.next=31;break;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.abrupt("return",n);case 34:case"end":return e.stop()}},null,null,[[8,21,25,33],[26,,28,32]])},e.next=7,regeneratorRuntime.awrap(c(a.id));case 7:return o=e.sent,s=o.map(function(e){return e.id}),e.next=11,regeneratorRuntime.awrap(Product.find({product_category_id:{$in:[a.id].concat(_toConsumableArray(s))},deleted:!1,status:"active"}).sort({position:"desc"}));case 11:for(i=e.sent,d=!(u=!0),p=void 0,e.prev=15,l=i[Symbol.iterator]();!(u=(f=l.next()).done);u=!0)(g=f.value).priceNew=(g.price*(100-g.discountPercentage)/100).toFixed(0);e.next=23;break;case 19:e.prev=19,e.t0=e.catch(15),d=!0,p=e.t0;case 23:e.prev=23,e.prev=24,u||null==l.return||l.return();case 26:if(e.prev=26,d)throw p;e.next=29;break;case 29:return e.finish(26);case 30:return e.finish(23);case 31:t.render("client/pages/products/index",{pageTitle:a.title,products:i});case 32:case"end":return e.stop()}},null,null,[[15,19,23,31],[24,,26,30]])},module.exports.detail=function(r,t){var n,a,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.params.slug,e.next=3,regeneratorRuntime.awrap(Product.findOne({slug:n,deleted:!1,status:"active"}));case 3:if(a=e.sent)return e.next=7,regeneratorRuntime.awrap(ProductCategory.findOne({_id:a.product_category_id,deleted:!1,status:"active"}));e.next=13;break;case 7:c=e.sent,a.category=c,a.priceNew=(a.price*(100-a.discountPercentage)/100).toFixed(0),t.render("client/pages/products/detail",{pageTitle:a.title,product:a}),e.next=14;break;case 13:t.redirect("/");case 14:case"end":return e.stop()}})};
//# sourceMappingURL=product.controller.min.js.map
