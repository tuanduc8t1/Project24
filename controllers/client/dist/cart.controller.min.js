"use strict";var Cart=require("../../models/cart.model"),Product=require("../../models/product.model");module.exports.index=function(t,r){var n,a,c,s,u,i,o,d;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(Cart.findOne({_id:t.cookies.cartId}));case 2:(n=e.sent).totalPrice=0,c=!(a=!0),s=void 0,e.prev=7,u=n.products[Symbol.iterator]();case 9:if(a=(i=u.next()).done){e.next=21;break}return o=i.value,e.next=13,regeneratorRuntime.awrap(Product.findOne({_id:o.product_id}).select("thumbnail title price discountPercentage stock slug"));case 13:(d=e.sent).priceNew=(d.price*(100-d.discountPercentage)/100).toFixed(0),d.totalPrice=d.priceNew*o.quantity,n.totalPrice+=d.totalPrice,o.infoProduct=d;case 18:a=!0,e.next=9;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(7),c=!0,s=e.t0;case 27:e.prev=27,e.prev=28,a||null==u.return||u.return();case 30:if(e.prev=30,c)throw s;e.next=33;break;case 33:return e.finish(30);case 34:return e.finish(27);case 35:r.render("client/pages/cart/index",{pageTitle:"Giỏ hàng",cartDetail:n});case 36:case"end":return e.stop()}},null,null,[[7,23,27,35],[28,,30,34]])},module.exports.addPost=function(t,r){var n,a,c,s,u,i,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.productId,a=parseInt(t.body.quantity),c=t.cookies.cartId,e.prev=3,e.next=6,regeneratorRuntime.awrap(Cart.findOne({_id:c}));case 6:if(s=e.sent,u=s.products.find(function(e){return e.product_id==n}))return i=u.quantity+a,e.next=12,regeneratorRuntime.awrap(Cart.updateOne({_id:c,"products.product_id":n},{$set:{"products.$.quantity":i}}));e.next=14;break;case 12:e.next=17;break;case 14:return o={product_id:n,quantity:a},e.next=17,regeneratorRuntime.awrap(Cart.updateOne({_id:c},{$push:{products:o}}));case 17:t.flash("success","Đã thêm sản phẩm vào giỏ hàng."),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(3),t.flash("error","Thêm sản phẩm vào giỏ hàng không thành công!");case 23:r.redirect("back");case 24:case"end":return e.stop()}},null,null,[[3,20]])},module.exports.deleteItem=function(t,r){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.productId,a=t.cookies.cartId,e.next=4,regeneratorRuntime.awrap(Cart.updateOne({_id:a},{$pull:{products:{product_id:n}}}));case 4:t.flash("success","Đã xóa sản phẩm khỏi giỏ hàng!"),r.redirect("back");case 6:case"end":return e.stop()}})},module.exports.updateItem=function(t,r){var n,a,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.params.productId,a=parseInt(t.params.quantity),c=t.cookies.cartId,e.next=5,regeneratorRuntime.awrap(Cart.updateOne({_id:c,"products.product_id":n},{$set:{"products.$.quantity":a}}));case 5:t.flash("success","Cập nhật sản phẩm thành công!"),r.redirect("back");case 7:case"end":return e.stop()}})};
//# sourceMappingURL=cart.controller.min.js.map
