{"version":3,"sources":["auth.controller.js"],"names":["md5","require","Account","systemConfig","module","req","res","render","pageTitle","exports","loginPost","email","password","user","regeneratorRuntime","async","_context2","prev","next","body","awrap","findOne","deleted","sent","flash","redirect","abrupt","status","cookie","token","prefixAdmin","stop","logout","_context3","clearCookie","concat"],"mappings":"aAAA,IAAMA,IAAMC,QAAQ,OACdC,QAAUD,QAAQ,8BAElBE,aAAeF,QAAQ,uBAA7BG,OAAMD,QAAAA,MAAeF,SAAQI,EAAAC,GAARL,OAAAA,mBAAAA,MAAAA,SAAAA,GAAAA,OAAAA,OAAAA,EAAAA,KAAAA,EAAAA,MAAAA,KAAAA,EAInBK,EAAIC,OAAO,yBAA0B,CACnCC,UAAW,cALMP,KAAAA,EAAAA,IAAAA,MAAAA,OAAAA,EAAAA,WAGEG,OAAAK,QAAAC,UAAA,SAAAL,EAAAC,GAAA,IAAAK,EAAAC,EAAAC,EAAA,OAAAC,mBAAAC,MAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OACrBZ,EAAIC,EAAJY,KAAWR,MACTH,EAAAA,EAAWW,KAAAP,SAFQI,EAAAE,KAAA,EAAAJ,mBAAAM,MAAAlB,QAAAmB,QAAA,CAAAV,MAAAA,EAAAW,SAAA,KAAA,KAAA,EAAA,GAAAT,EAAAG,EAAAO,KAAA,CAAAP,EAAAE,KAAA,EAAA,MAAA,OAMvBb,EAAAmB,MAAA,QAAA,wBAaIlB,EAAImB,SAAS,QAnBMT,EAAAU,OAAA,UAAA,KAAA,EAAA,GAOI1B,IAAAY,IAAAC,EAAAD,SAPJ,OAOIP,EAAAmB,MAAA,QAAA,iBAAAlB,EAAAmB,SAAA,QAPJT,EAAAU,OAAA,UAAAV,EAAAE,KAAA,GAAA,MAAA,KAAA,GAAA,GAOI,UAAAL,EAAAc,OAPJ,OAOItB,EAAAmB,MAAA,QAAA,2BAMvBb,EAAAA,SAAK,QAbcK,EAAAU,OAAA,UAAAV,EAAAE,KAAA,GAAA,MAAA,KAAA,GAOIZ,EAAAsB,OAAA,QAAAf,EAAAgB,OAKnBhB,EAAAA,SAAAA,IAAAA,OALmBV,aAAA2B,YAKnBjB,eAZe,KAAA,GAAA,IAAA,MAAA,OAAAG,EAAAe,WAOI3B,OAAAK,QAAAuB,OAAA,SAAA3B,EAAAC,GAAA,OAAAQ,mBAAAC,MAAA,SAAAkB,GAAA,OAAA,OAAAA,EAAAhB,KAAAgB,EAAAf,MAAA,KAAA,EAAAZ,EAAA4B,YAAA,SAmCzB5B,EAAImB,SAAJ,IAAAU,OAAiBhC,aAAa2B,YAA9B,gBAnCyB,KAAA,EAAA,IAAA,MAAA,OAAAG,EAAAF","file":"auth.controller.min.js","sourcesContent":["const md5 = require(\"md5\");\nconst Account = require(\"../../models/account.model\");\n\nconst systemConfig = require(\"../../config/system\");\n\n// [GET] /admin/auth/login\nmodule.exports.login = async (req, res) => {\n  res.render(\"admin/pages/auth/login\", {\n    pageTitle: \"Đăng nhập\",\n  });\n};\n\n// [POST] /admin/auth/login\nmodule.exports.loginPost = async (req, res) => {\n  const email = req.body.email;\n  const password = req.body.password;\n  \n  \n  const user = await Account.findOne({\n    email: email,\n    deleted: false\n  });\n\n  if(!user) {\n    req.flash(\"error\", \"Email không tồn tại!\");\n    res.redirect(\"back\");\n    return;\n  }\n\n  if(md5(password) != user.password) {\n    req.flash(\"error\", \"Sai mật khẩu!\");\n    res.redirect(\"back\");\n    return;\n  }\n\n  if(user.status != \"active\") {\n    req.flash(\"error\", \"Tài khoản đang bị khóa!\");\n    res.redirect(\"back\");\n    return;\n  }\n  \n  res.cookie(\"token\", user.token);\n  res.redirect(`/${systemConfig.prefixAdmin}/dashboard`);\n};\n\n// [GET] /admin/auth/logout\nmodule.exports.logout = async (req, res) => {\n  res.clearCookie(\"token\");\n  res.redirect(`/${systemConfig.prefixAdmin}/auth/login`);\n};"]}